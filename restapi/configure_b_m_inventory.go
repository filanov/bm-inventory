// Code generated by go-swagger; DO NOT EDIT.

package restapi

import (
	"context"
	"encoding/json"
	"fmt"
	"net/http"

	"github.com/go-openapi/errors"
	"github.com/go-openapi/loads"
	"github.com/go-openapi/runtime"
	"github.com/go-openapi/runtime/middleware"

	"github.com/filanov/bm-inventory/restapi/operations"
	"github.com/filanov/bm-inventory/restapi/operations/inventory"
)

type contextKey string

const AuthKey contextKey = "Auth"

//go:generate mockery -name InventoryAPI -inpkg

// InventoryAPI
type InventoryAPI interface {
	DeregisterCluster(ctx context.Context, params inventory.DeregisterClusterParams) middleware.Responder
	DeregisterHost(ctx context.Context, params inventory.DeregisterHostParams) middleware.Responder
	DisableHost(ctx context.Context, params inventory.DisableHostParams) middleware.Responder
	DownloadClusterFiles(ctx context.Context, params inventory.DownloadClusterFilesParams) middleware.Responder
	DownloadClusterISO(ctx context.Context, params inventory.DownloadClusterISOParams) middleware.Responder
	EnableHost(ctx context.Context, params inventory.EnableHostParams) middleware.Responder
	GenerateClusterISO(ctx context.Context, params inventory.GenerateClusterISOParams) middleware.Responder
	GetCluster(ctx context.Context, params inventory.GetClusterParams) middleware.Responder
	GetHost(ctx context.Context, params inventory.GetHostParams) middleware.Responder
	GetNextSteps(ctx context.Context, params inventory.GetNextStepsParams) middleware.Responder
	InstallCluster(ctx context.Context, params inventory.InstallClusterParams) middleware.Responder
	ListClusters(ctx context.Context, params inventory.ListClustersParams) middleware.Responder
	ListHosts(ctx context.Context, params inventory.ListHostsParams) middleware.Responder
	PostStepReply(ctx context.Context, params inventory.PostStepReplyParams) middleware.Responder
	RegisterCluster(ctx context.Context, params inventory.RegisterClusterParams) middleware.Responder
	RegisterHost(ctx context.Context, params inventory.RegisterHostParams) middleware.Responder
	SetDebugStep(ctx context.Context, params inventory.SetDebugStepParams) middleware.Responder
	UpdateCluster(ctx context.Context, params inventory.UpdateClusterParams) middleware.Responder
	UpdateHostInstallProgress(ctx context.Context, params inventory.UpdateHostInstallProgressParams) middleware.Responder
}

// Config is configuration for Handler
type Config struct {
	InventoryAPI
	Logger func(string, ...interface{})
	// InnerMiddleware is for the handler executors. These do not apply to the swagger.json document.
	// The middleware executes after routing but before authentication, binding and validation
	InnerMiddleware func(http.Handler) http.Handler

	// Authorizer is used to authorize a request after the Auth function was called using the "Auth*" functions
	// and the principal was stored in the context in the "AuthKey" context value.
	Authorizer func(*http.Request) error
}

// Handler returns an http.Handler given the handler configuration
// It mounts all the business logic implementers in the right routing.
func Handler(c Config) (http.Handler, error) {
	h, _, err := HandlerAPI(c)
	return h, err
}

// HandlerAPI returns an http.Handler given the handler configuration
// and the corresponding *BMInventory instance.
// It mounts all the business logic implementers in the right routing.
func HandlerAPI(c Config) (http.Handler, *operations.BMInventoryAPI, error) {
	spec, err := loads.Analyzed(swaggerCopy(SwaggerJSON), "")
	if err != nil {
		return nil, nil, fmt.Errorf("analyze swagger: %v", err)
	}
	api := operations.NewBMInventoryAPI(spec)
	api.ServeError = errors.ServeError
	api.Logger = c.Logger

	api.JSONConsumer = runtime.JSONConsumer()
	api.BinProducer = runtime.ByteStreamProducer()
	api.JSONProducer = runtime.JSONProducer()
	api.InventoryDeregisterClusterHandler = inventory.DeregisterClusterHandlerFunc(func(params inventory.DeregisterClusterParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.DeregisterCluster(ctx, params)
	})
	api.InventoryDeregisterHostHandler = inventory.DeregisterHostHandlerFunc(func(params inventory.DeregisterHostParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.DeregisterHost(ctx, params)
	})
	api.InventoryDisableHostHandler = inventory.DisableHostHandlerFunc(func(params inventory.DisableHostParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.DisableHost(ctx, params)
	})
	api.InventoryDownloadClusterFilesHandler = inventory.DownloadClusterFilesHandlerFunc(func(params inventory.DownloadClusterFilesParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.DownloadClusterFiles(ctx, params)
	})
	api.InventoryDownloadClusterISOHandler = inventory.DownloadClusterISOHandlerFunc(func(params inventory.DownloadClusterISOParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.DownloadClusterISO(ctx, params)
	})
	api.InventoryEnableHostHandler = inventory.EnableHostHandlerFunc(func(params inventory.EnableHostParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.EnableHost(ctx, params)
	})
	api.InventoryGenerateClusterISOHandler = inventory.GenerateClusterISOHandlerFunc(func(params inventory.GenerateClusterISOParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.GenerateClusterISO(ctx, params)
	})
	api.InventoryGetClusterHandler = inventory.GetClusterHandlerFunc(func(params inventory.GetClusterParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.GetCluster(ctx, params)
	})
	api.InventoryGetHostHandler = inventory.GetHostHandlerFunc(func(params inventory.GetHostParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.GetHost(ctx, params)
	})
	api.InventoryGetNextStepsHandler = inventory.GetNextStepsHandlerFunc(func(params inventory.GetNextStepsParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.GetNextSteps(ctx, params)
	})
	api.InventoryInstallClusterHandler = inventory.InstallClusterHandlerFunc(func(params inventory.InstallClusterParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.InstallCluster(ctx, params)
	})
	api.InventoryListClustersHandler = inventory.ListClustersHandlerFunc(func(params inventory.ListClustersParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.ListClusters(ctx, params)
	})
	api.InventoryListHostsHandler = inventory.ListHostsHandlerFunc(func(params inventory.ListHostsParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.ListHosts(ctx, params)
	})
	api.InventoryPostStepReplyHandler = inventory.PostStepReplyHandlerFunc(func(params inventory.PostStepReplyParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.PostStepReply(ctx, params)
	})
	api.InventoryRegisterClusterHandler = inventory.RegisterClusterHandlerFunc(func(params inventory.RegisterClusterParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.RegisterCluster(ctx, params)
	})
	api.InventoryRegisterHostHandler = inventory.RegisterHostHandlerFunc(func(params inventory.RegisterHostParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.RegisterHost(ctx, params)
	})
	api.InventorySetDebugStepHandler = inventory.SetDebugStepHandlerFunc(func(params inventory.SetDebugStepParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.SetDebugStep(ctx, params)
	})
	api.InventoryUpdateClusterHandler = inventory.UpdateClusterHandlerFunc(func(params inventory.UpdateClusterParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.UpdateCluster(ctx, params)
	})
	api.InventoryUpdateHostInstallProgressHandler = inventory.UpdateHostInstallProgressHandlerFunc(func(params inventory.UpdateHostInstallProgressParams) middleware.Responder {
		ctx := params.HTTPRequest.Context()
		return c.InventoryAPI.UpdateHostInstallProgress(ctx, params)
	})
	api.ServerShutdown = func() {}
	return api.Serve(c.InnerMiddleware), api, nil
}

// swaggerCopy copies the swagger json to prevent data races in runtime
func swaggerCopy(orig json.RawMessage) json.RawMessage {
	c := make(json.RawMessage, len(orig))
	copy(c, orig)
	return c
}

// authorizer is a helper function to implement the runtime.Authorizer interface.
type authorizer func(*http.Request) error

func (a authorizer) Authorize(req *http.Request, principal interface{}) error {
	if a == nil {
		return nil
	}
	ctx := storeAuth(req.Context(), principal)
	return a(req.WithContext(ctx))
}

func storeAuth(ctx context.Context, principal interface{}) context.Context {
	return context.WithValue(ctx, AuthKey, principal)
}
